<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - 백엔드 개발자 서정훈</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <!-- 새로운 CSS 구조 -->
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>

    <div class="container">
        <main class="content">
            <div>
                <br>
                <br>
            </div>
            <!-- 홈 버튼 -->
            <div class="home-button">
                <a href="/" title="홈으로 돌아가기">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <br><br><br>
            </div>
            {{ content|safe }}
        </main>
    </div>

    <!-- Prism.js 코어 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- 복사 기능 플러그인 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const overlayContainer = document.createElement('div');
        overlayContainer.className = 'image-overlay-container';
        overlayContainer.innerHTML = `
            <button class="close-button">&times;</button>
            <img src="" alt="Overlay Image" draggable="false">
        `;
        document.body.appendChild(overlayContainer);

        const overlayImage = overlayContainer.querySelector('img');
        const closeButton = overlayContainer.querySelector('.close-button');

        let isZoomed = false;
        let isDragging = false;
        let startX = 0, startY = 0;
        let translateX = 0, translateY = 0;
        let initialDistance = 0; // 두 손가락 간 초기 거리

        function preventTouchMove(e) {
            e.preventDefault();
        }

        // 오버레이 열기
        function openOverlay() {
            overlayContainer.classList.add('active');
            document.body.style.overflow = 'hidden';
            window.addEventListener('touchmove', preventTouchMove, { passive: false });
        }

        // 오버레이 닫기
        function closeOverlay() {
            overlayContainer.classList.remove('active');
            document.body.style.overflow = '';
            window.removeEventListener('touchmove', preventTouchMove, { passive: false });
            resetImagePosition();
        }

        // 이미지 클릭 시
        document.querySelectorAll('main.content img').forEach(img => {
            img.addEventListener('click', () => {
                overlayImage.src = img.src;
                openOverlay();
            });
        });

        // 닫기 버튼
        closeButton.addEventListener('click', closeOverlay);

        // ESC 키
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeOverlay();
            }
        });

        // 더블클릭으로 확대/축소 (데스크톱)
        overlayImage.addEventListener('dblclick', () => {
            toggleZoom();
        });

        // 더블 터치로 확대/축소 (모바일)
        overlayImage.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                isDragging = true;
            } else if (e.touches.length === 2) {
                // 두 손가락 간 거리 계산
                initialDistance = getDistance(e.touches[0], e.touches[1]);
            }
        });

        overlayImage.addEventListener('touchmove', (e) => {
            if (isDragging && isZoomed && e.touches.length === 1) {
                const touch = e.touches[0];
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;
                translateX += deltaX;
                translateY += deltaY;
                overlayImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(2)`;
                startX = touch.clientX;
                startY = touch.clientY;
            } else if (e.touches.length === 2) {
                // 두 손가락 간 거리 변화 계산
                const currentDistance = getDistance(e.touches[0], e.touches[1]);
                if (currentDistance < initialDistance * 0.8) { // 축소 동작 감지
                    resetImagePosition();
                    isZoomed = false;
                }
            }
        });

        document.addEventListener('touchend', (e) => {
            if (e.touches.length === 0) {
                isDragging = false;
            }
        });

        // 이미지 드래그 시작 (마우스)
        overlayImage.addEventListener('mousedown', (e) => {
            if (isZoomed) {
                e.preventDefault();
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                overlayImage.style.cursor = 'grabbing';
            }
        });

        // 이미지 드래그 이동 (마우스)
        document.addEventListener('mousemove', (e) => {
            if (isDragging && isZoomed) {
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                translateX += deltaX;
                translateY += deltaY;
                overlayImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(2)`;
                startX = e.clientX;
                startY = e.clientY;
            }
        });

        // 이미지 드래그 종료 (마우스)
        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                overlayImage.style.cursor = 'grab';
            }
        });

        // 확대/축소 토글 함수
        function toggleZoom() {
            if (isZoomed) {
                overlayImage.style.transform = 'translate(0, 0) scale(1)';
                isZoomed = false;
                resetImagePosition();
            } else {
                overlayImage.style.transform = 'scale(2)';
                isZoomed = true;
            }
        }

        // 이미지 위치 초기화
        function resetImagePosition() {
            translateX = 0;
            translateY = 0;
            overlayImage.style.transform = 'translate(0, 0) scale(1)';
        }

        // 두 손가락 간 거리 계산 함수
        function getDistance(touch1, touch2) {
            const deltaX = touch2.clientX - touch1.clientX;
            const deltaY = touch2.clientY - touch1.clientY;
            return Math.sqrt(deltaX * deltaX + deltaY * deltaY);
        }
    });
</script>
</body>
</html>