<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - ë°±ì—”ë“œ ê°œë°œì ì„œì •í›ˆ</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <!-- Prism.js íˆ´ë°” í”ŒëŸ¬ê·¸ì¸ CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css">
    <!-- ìƒˆë¡œìš´ CSS êµ¬ì¡° -->
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>

    <div class="container">
        <main class="content">
            <div>
                <br>
                <br>
            </div>
            <!-- í™ˆ ë²„íŠ¼ -->
            <div class="home-button">
                <a href="/" title="í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <br><br><br>
            </div>
            {{ content|safe }}

<!-- ë³µì‚¬ ë²„íŠ¼ì€ Prism.js toolbar í”ŒëŸ¬ê·¸ì¸ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ -->
        </main>
    </div>

    <!-- Prism.js ì½”ì–´ ë° í”ŒëŸ¬ê·¸ì¸ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <!-- íˆ´ë°” í”ŒëŸ¬ê·¸ì¸ (ë³µì‚¬ ë²„íŠ¼ì˜ ê¸°ë°˜) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
    <!-- ë³µì‚¬ ê¸°ëŠ¥ í”ŒëŸ¬ê·¸ì¸ë§Œ ì‚¬ìš© (ì–¸ì–´ ë¼ë²¨ í”ŒëŸ¬ê·¸ì¸ ì œê±°) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
    
<script>
    // ì–¸ì–´ ë¼ë²¨ì„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ (CSS ::beforeë¡œ í‘œì‹œ)
    function addLanguageLabels() {
        document.querySelectorAll('pre code[class*="language-"]').forEach((codeElement) => {
            const pre = codeElement.parentElement;
            const className = codeElement.className;
            const match = className.match(/language-(\w+)/);
            
            if (match && !pre.hasAttribute('data-language')) {
                const language = match[1].toUpperCase();
                pre.setAttribute('data-language', language);
                pre.classList.add(`language-${match[1]}`);
            }
        });
    }

    // GitHub APIë¥¼ ì‚¬ìš©í•œ ì €ì¥ì†Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    async function fetchGitHubRepoInfo(owner, repo) {
        try {
            const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`);
            if (response.ok) {
                const data = await response.json();
                return {
                    name: data.name,
                    description: data.description || 'GitHub ì €ì¥ì†Œì—ì„œ í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œì™€ ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”',
                    language: data.language,
                    stars: data.stargazers_count,
                    forks: data.forks_count,
                    topics: data.topics || [],
                    updated: new Date(data.updated_at).toLocaleDateString('ko-KR'),
                    owner: data.owner.login,
                    fullName: data.full_name
                };
            }
        } catch (error) {
            console.log('GitHub API í˜¸ì¶œ ì‹¤íŒ¨:', error);
        }
        return null;
    }

    // GitHub ë§í¬ ì¹´ë“œ ë³€í™˜ í•¨ìˆ˜ (í–¥ìƒëœ ë²„ì „)
    async function convertGithubLinks() {
        const githubLinks = document.querySelectorAll('a[href*="github.com"]');
        
        for (const link of githubLinks) {
            const linkText = link.textContent.trim();
            if (linkText === 'github-link' || linkText.includes('github-link')) {
                // URLì—ì„œ í”„ë¡œì íŠ¸ ì •ë³´ ì¶”ì¶œ
                const url = link.href;
                const urlParts = url.split('/');
                const owner = urlParts[urlParts.length - 2];
                const repo = urlParts[urlParts.length - 1];
                
                // ìƒˆì°½ìœ¼ë¡œ ì—´ë¦¬ë„ë¡ ì†ì„± ì¶”ê°€
                link.setAttribute('target', '_blank');
                link.setAttribute('rel', 'noopener noreferrer');
                
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                link.innerHTML = `
                    <div class="github-link-card-header">
                        <i class="fab fa-github github-link-card-icon"></i>
                        <span class="github-link-card-title">ë¡œë”© ì¤‘...</span>
                    </div>
                    <div class="github-link-card-description">ì €ì¥ì†Œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
                    <div class="github-link-card-url">${url.replace('https://', '')}</div>
                `;
                link.classList.add('github-link-card');
                
                // GitHub APIì—ì„œ ì‹¤ì œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const repoInfo = await fetchGitHubRepoInfo(owner, repo);
                
                if (repoInfo) {
                    // ì‹¤ì œ ì €ì¥ì†Œ ì •ë³´ë¡œ ì—…ë°ì´íŠ¸
                    link.innerHTML = `
                        <div class="github-link-card-header">
                            <div class="github-card-left">
                                <i class="fab fa-github github-link-card-icon"></i>
                                <span class="github-link-card-title">${repoInfo.name}</span>
                            </div>
                            <div class="github-link-card-stats">
                                ${repoInfo.language ? `<span class="repo-language">${repoInfo.language}</span>` : ''}
                                <span class="repo-stars">â­ ${repoInfo.stars}</span>
                                <span class="repo-forks">ğŸ´ ${repoInfo.forks}</span>
                            </div>
                        </div>
                        <div class="github-link-card-description">${repoInfo.description}</div>
                        ${repoInfo.topics.length > 0 ? `
                            <div class="github-link-card-topics">
                                ${repoInfo.topics.map(topic => `<span class="topic-tag">#${topic}</span>`).join('')}
                            </div>
                        ` : ''}
                        <div class="github-link-card-footer">
                            <div class="github-link-card-url">${url.replace('https://', '')}</div>
                            <div class="github-link-card-updated">ìµœê·¼ ì—…ë°ì´íŠ¸: ${repoInfo.updated}</div>
                        </div>
                        <div class="github-link-card-external">
                            <i class="fas fa-external-link-alt"></i>
                            <span>ìƒˆì°½ì—ì„œ ì—´ê¸°</span>
                        </div>
                    `;
                } else {
                    // API í˜¸ì¶œ ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ì •ë³´ë¡œ í‘œì‹œ
                    link.innerHTML = `
                        <div class="github-link-card-header">
                            <div class="github-card-left">
                                <i class="fab fa-github github-link-card-icon"></i>
                                <span class="github-link-card-title">${repo}</span>
                            </div>
                        </div>
                        <div class="github-link-card-description">GitHub ì €ì¥ì†Œì—ì„œ í”„ë¡œì íŠ¸ ì†ŒìŠ¤ì½”ë“œì™€ ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”</div>
                        <div class="github-link-card-url">${url.replace('https://', '')}</div>
                        <div class="github-link-card-external">
                            <i class="fas fa-external-link-alt"></i>
                            <span>ìƒˆì°½ì—ì„œ ì—´ê¸°</span>
                        </div>
                    `;
                }
            }
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        // ì–¸ì–´ ë¼ë²¨ ì¶”ê°€
        addLanguageLabels();
        
        // GitHub ë§í¬ ì¹´ë“œ ë³€í™˜
        convertGithubLinks();
        
        // Prism.js í•˜ì´ë¼ì´íŒ… ì‹¤í–‰
        if (window.Prism) {
            Prism.highlightAll();
        }
        
        // ì´ë¯¸ì§€ ì˜¤ë²„ë ˆì´ ê¸°ëŠ¥
        const overlayContainer = document.createElement('div');
        overlayContainer.className = 'image-overlay-container';
        overlayContainer.innerHTML = `
            <button class="close-button">&times;</button>
            <img src="" alt="Overlay Image" draggable="false">
        `;
        document.body.appendChild(overlayContainer);

        const overlayImage = overlayContainer.querySelector('img');
        const closeButton = overlayContainer.querySelector('.close-button');

        let isZoomed = false;
        let isDragging = false;
        let startX = 0, startY = 0;
        let translateX = 0, translateY = 0;
        let initialDistance = 0;

        function preventTouchMove(e) {
            e.preventDefault();
        }

        function openOverlay() {
            overlayContainer.classList.add('active');
            document.body.style.overflow = 'hidden';
            window.addEventListener('touchmove', preventTouchMove, { passive: false });
        }

        function closeOverlay() {
            overlayContainer.classList.remove('active');
            document.body.style.overflow = '';
            window.removeEventListener('touchmove', preventTouchMove, { passive: false });
            resetImagePosition();
        }

        document.querySelectorAll('main.content img').forEach(img => {
            img.addEventListener('click', () => {
                overlayImage.src = img.src;
                openOverlay();
            });
        });

        closeButton.addEventListener('click', closeOverlay);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeOverlay();
            }
        });

        overlayImage.addEventListener('dblclick', () => {
            toggleZoom();
        });

        overlayImage.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                startX = touch.clientX;
                startY = touch.clientY;
                isDragging = true;
            } else if (e.touches.length === 2) {
                initialDistance = getDistance(e.touches[0], e.touches[1]);
            }
        });

        overlayImage.addEventListener('touchmove', (e) => {
            if (isDragging && isZoomed && e.touches.length === 1) {
                const touch = e.touches[0];
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;
                translateX += deltaX;
                translateY += deltaY;
                overlayImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(2)`;
                startX = touch.clientX;
                startY = touch.clientY;
            } else if (e.touches.length === 2) {
                const currentDistance = getDistance(e.touches[0], e.touches[1]);
                if (currentDistance < initialDistance * 0.8) {
                    resetImagePosition();
                    isZoomed = false;
                }
            }
        });

        document.addEventListener('touchend', (e) => {
            if (e.touches.length === 0) {
                isDragging = false;
            }
        });

        overlayImage.addEventListener('mousedown', (e) => {
            if (isZoomed) {
                e.preventDefault();
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                overlayImage.style.cursor = 'grabbing';
            }
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging && isZoomed) {
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                translateX += deltaX;
                translateY += deltaY;
                overlayImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(2)`;
                startX = e.clientX;
                startY = e.clientY;
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                overlayImage.style.cursor = 'grab';
            }
        });

        function toggleZoom() {
            if (isZoomed) {
                overlayImage.style.transform = 'translate(0, 0) scale(1)';
                isZoomed = false;
                resetImagePosition();
            } else {
                overlayImage.style.transform = 'scale(2)';
                isZoomed = true;
            }
        }

        function resetImagePosition() {
            translateX = 0;
            translateY = 0;
            overlayImage.style.transform = 'translate(0, 0) scale(1)';
        }

        function getDistance(touch1, touch2) {
            const deltaX = touch2.clientX - touch1.clientX;
            const deltaY = touch2.clientY - touch1.clientY;
            return Math.sqrt(deltaX * deltaX + deltaY * deltaX);
        }
    });
</script>
</body>
</html>