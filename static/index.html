<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - ë°±ì—”ë“œ ê°œë°œì ì„œì •í›ˆ</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ìƒˆë¡œìš´ CSS êµ¬ì¡° -->
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="container">
        <!-- í”„ë¡œí•„ + ì•½ë ¥ í†µí•© ì„¹ì…˜ -->
        <section class="profile-career-section">
            <!-- ì¢Œì¸¡ í”„ë¡œí•„ -->
            <div class="profile-left">
                <div class="profile-image">
                    <img src="/images/me.webp" alt="ì„œì •í›ˆ í”„ë¡œí•„ ì‚¬ì§„">
                </div>
                <div class="profile-info">
                    <div class="name-title">
                        <h1>ì„œì •í›ˆ</h1>
                        <span class="title-separator">|</span>
                        <p class="subtitle">Backend Developer</p>
                    </div>
                    <div class="profile-description">
                        <div class="profile-main">
                            <strong>REST-Like ê¸°ë°˜ FastAPI ë° Docker í”„ë¡œì íŠ¸ êµ¬ì¶•</strong>
                            <ul class="profile-detail">
                                <li>Dockerì˜ libsì™€ baseë¥¼ í™œìš©, ë¶ˆí•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¬ì„¤ì¹˜ë¥¼ ë°©ì§€, AI ì„œë²„ ë¦¬ë¹Œë“œ ì‹œê°„ì„ 83.33% ê°œì„ </li>
                            </ul>
                        </div>
                        <div class="profile-main">
                            <strong>TreeNut ê¹ƒí—ˆë¸Œ ì¡°ì§ì—ì„œ íŒ€ì¥ í™œë™</strong>
                            <ul class="profile-detail">
                                <li>JMEDUSERVER íŒ€ í”„ë¡œì íŠ¸ 2ê°œì›”ê°„ ì§„í–‰, í‚¤ì˜¤ìŠ¤í¬ ê³„ì•½ ë° íŒë§¤</li>
                                <li>ChatBot íŒ€ í”„ë¡œì íŠ¸ 9ê°œì›”ê°„ ì§„í–‰, íŒ€ì›ë“¤ê³¼ í˜‘ì—… ë° ë°°í¬, ì„œë¹„ìŠ¤ ì§„í–‰ ì¤‘</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- ì†Œì…œ ë§í¬ -->
                    <div class="social-links">
                        <a href="https://github.com/CutTheWire" target="_blank" rel="noopener" class="link-item">
                            <div class="link-header">
                                <i class="fab fa-github link-icon"></i>
                                <span class="link-title">GitHub</span>
                                <span class="link-separator">|</span>
                                <span class="link-description">ê°œì¸ í”„ë¡œì íŠ¸ ë° ì½”ë“œ ì €ì¥ì†Œ</span>
                            </div>
                        </a>
                        
                        <a href="https://github.com/TreeNut-KR" target="_blank" rel="noopener" class="link-item">
                            <div class="link-header">
                                <i class="fas fa-users link-icon"></i>
                                <span class="link-title">TreeNut</span>
                                <span class="link-separator">|</span>
                                <span class="link-description">íŒ€ í”„ë¡œì íŠ¸ ë° í˜‘ì—… ì¡°ì§</span>
                            </div>
                        </a>
                        
                        <a href="https://treenut.ddns.net" target="_blank" rel="noopener" class="link-item">
                            <div class="link-header">
                                <i class="fas fa-robot link-icon"></i>
                                <span class="link-title">TreeNut AI</span>
                                <span class="link-separator">|</span>
                                <span class="link-description">AI ì—ì´ì „íŠ¸ ë° ìºë¦­í„° ì±—ë´‡</span>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- ìš°ì¸¡ ì•½ë ¥ -->
            <div class="career-right">
                <h2 class="career-title">
                    <i class="fas fa-timeline"></i>
                    ì•½ë ¥ ë‚´ì—­
                </h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-date">2019.03 - 2024.02</div>
                        <div class="timeline-content">ì²­ìš´ëŒ€í•™êµ ì»´í“¨í„°ê³µí•™ê³¼ ì…í•™</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2019.06</div>
                        <div class="timeline-content">
                            <a href="https://drive.google.com/file/d/1Hp_mQNc8TAn6sdRyxwNyBJOkNu21jNzv" target="_blank" rel="noopener">
                                ì¸ì²œì„œë¶€ì†Œë°©ì„œì¥ í‘œì°½ì¥ ìˆ˜ì—¬
                            </a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2020.01</div>
                        <div class="timeline-content">
                            <a href="https://drive.google.com/file/d/1vVK01h9xqusmZVl5fItSla0GjdM2saJI" target="_blank" rel="noopener">
                                ëŠ¥ë ¥ê°œë°œêµìœ¡ì› ì›Œí¬ë„· ì§ì—…ì‹¬ë¦¬ê²€ì‚¬ ê²°ê³¼ë¥¼ í™œìš©í•œ ì§„ë¡œì§€ë„ ì½”ì¹­ ê¸°ë²• ìˆ˜ë£Œ
                            </a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2021.05 - 2023.02</div>
                        <div class="timeline-content">ê³µêµ° ë¬´ì„ í†µì‹ ë³‘ ë³µë¬´</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2023.07 - 2023.09</div>
                        <div class="timeline-content">íƒ€ì´ë‹ˆì›¨ì´ë¸Œ ë°±ì—”ë“œ ê°œë°œ ì·¨ì—…ì—°ê³„ ì°¸ì—¬</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2023.09 - 2024.02</div>
                        <div class="timeline-content">
                            <a href="https://drive.google.com/file/d/1Sak7KrXt3_JEzKhuRik08QhyOSH4FQzu" target="_blank" rel="noopener">
                                ICT í•™ì ì—°ê³„ í”„ë¡œì íŠ¸ ì¸í„´ì‹­, íƒ€ì´ë‹ˆì›¨ì´ë¸Œ ì»´í“¨í„° ë¹„ì „ ê°œë°œ ì¸í„´ ì°¸ì—¬
                            </a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2024.06</div>
                        <div class="timeline-content">JMEDUSERVER í”„ë¡œì íŠ¸ í•™ìƒ ì¶œì„ í‚¤ì˜¤ìŠ¤í¬ í”„ë¡œì íŠ¸ ì™¸ì£¼ ê³„ì•½</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2024.07 - 2024.08</div>
                        <div class="timeline-content">ì—ì½”ë“œì¸ ë°±ì—”ë“œ ê°œë°œ ì·¨ì—…ì—°ê³„ ì°¸ì—¬</div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2025.05</div>
                        <div class="timeline-content">
                            <a href="https://treenut.ddns.net" target="_blank" rel="noopener">
                                chatbot íŒ€ í”„ë¡œì íŠ¸ë¡œ TreeNut AI ì±—ë´‡ ì„œë¹„ìŠ¤ ë°°í¬
                            </a>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-date">2025.06</div>
                        <div class="timeline-content">
                            <a href="https://drive.google.com/file/d/1BiZWUlvXdNQkz1hxWzpiwSbejEzWDjfZ" target="_blank" rel="noopener">
                                ëŠ¥ë ¥ê°œë°œêµìœ¡ì› (ìŠ¤ë§ˆíŠ¸ê³µì¥)ì¸ê³µì§€ëŠ¥ ë¹„ì „ì¸ì‹ ê¸°ë°˜ í˜‘ë™ë¡œë´‡ ì œì–´ ìˆ˜ë£Œ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <main class="content">
            {{ content|safe }}
        </main>
    </div>

    <!-- ìš°ì¸¡ í•˜ë‹¨ ê³ ì • ì´ë©”ì¼ ë²„íŠ¼ -->
    <button class="email-floating-button" onclick="openEmailModal()" title="ì´ë©”ì¼ ë³´ë‚´ê¸°">
        <i class="fas fa-envelope"></i>
    </button>

    <!-- ì´ë©”ì¼ ì˜¤ë²„ë ˆì´ -->
    <div class="email-overlay" id="emailOverlay">
        <div class="email-modal">
            <div class="email-modal-header">
                <h3 class="email-modal-title">
                    <i class="fas fa-envelope"></i>
                    ì´ë©”ì¼ ì „ì†¡
                </h3>
                <button class="email-modal-close" onclick="closeEmailModal()" title="ë‹«ê¸°">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- SMTP ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="email-info-notice">
                <div class="email-info-header">
                    <i class="fas fa-info-circle"></i>
                    <strong>ì‹¤ì œ ì´ë©”ì¼ ì „ì†¡ ì„œë¹„ìŠ¤</strong>
                </div>
                <div class="email-info-content">
                    â€¢ ì´ ì–‘ì‹ìœ¼ë¡œ ì „ì†¡ëœ ë©”ì¼ì€ <strong>SMTPë¥¼ í†µí•´ ì‹¤ì œë¡œ ë°œì†¡</strong>ë©ë‹ˆë‹¤<br>
                    â€¢ ì…ë ¥í•˜ì‹  <strong>ì´ë©”ì¼ ì£¼ì†Œë¡œ ë‹µë³€</strong>ì„ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤<br>
                    â€¢ ë‹¨ìˆœí•œ ë¬¸ì˜ ì–‘ì‹ì´ ì•„ë‹Œ <strong>ì‹¤ì œ ë©”ì¼ ì‹œìŠ¤í…œ</strong>ì…ë‹ˆë‹¤
                </div>
            </div>
            
            <!-- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì•Œë¦¼ -->
            <div class="email-network-error" id="emailNetworkError">
                <i class="fas fa-exclamation-triangle"></i>
                ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
            </div>
            
            <div id="emailFormContainer">
                <form class="email-form" onsubmit="sendEmail(event)">
                    <div class="email-form-group">
                        <label class="email-form-label" for="senderName">ì´ë¦„ *</label>
                        <input 
                            type="text" 
                            id="senderName" 
                            name="sender_name"
                            class="email-form-input" 
                            required 
                            placeholder="í™ê¸¸ë™"
                        >
                        <div class="email-field-error" id="nameError"></div>
                    </div>
                    
                    <div class="email-form-group">
                        <label class="email-form-label" for="senderEmail">
                            ë‹µë³€ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œ *
                            <span class="email-reply-notice">ë‹µë³€ì„ ë°›ìœ¼ì‹¤ ì‹¤ì œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”</span>
                        </label>
                        <input 
                            type="email" 
                            id="senderEmail" 
                            name="sender_email"
                            class="email-form-input" 
                            required 
                            placeholder="example@email.com"
                        >
                        <div class="email-field-error" id="emailError"></div>
                    </div>
                    
                    <div class="email-form-group">
                        <label class="email-form-label" for="subject">ì œëª© *</label>
                        <input 
                            type="text" 
                            id="subject" 
                            name="subject"
                            class="email-form-input" 
                            required 
                            placeholder="í˜‘ì—… ì œì•ˆ / ë¬¸ì˜ì‚¬í•­ ë“±"
                        >
                        <div class="email-field-error" id="subjectError"></div>
                    </div>
                    
                    <div class="email-form-group">
                        <label class="email-form-label" for="message">ë©”ì‹œì§€ *</label>
                        <textarea 
                            id="message" 
                            name="message"
                            class="email-form-textarea" 
                            required 
                            placeholder="í˜‘ì—… ì œì•ˆ, í”„ë¡œì íŠ¸ ë¬¸ì˜, ê¸°ìˆ  ìƒë‹´ ë“± 
ì–´ë–¤ ë‚´ìš©ì´ë“  í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”.

ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ì§ì ‘ ë‹µë³€ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
                        ></textarea>
                        <div class="email-field-error" id="messageError"></div>
                    </div>
                    
                    <div class="email-form-buttons">
                        <button type="button" class="email-form-cancel" onclick="closeEmailModal()">
                            â“ë‹¤ì‹œ ìƒê°í•´ ë³¼ê²Œ...
                        </button>
                        <button type="submit" class="email-form-submit" id="emailSubmitButton">
                            <i class="fas fa-paper-plane"></i>
                            ì´ë©”ì¼ ì „ì†¡
                        </button>
                    </div>
                </form>
            </div>
            
            <div id="emailSuccessContainer" class="email-container-hidden">
                <div class="email-success-message">
                    <div class="email-success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h4 class="email-success-title">ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!</h4>
                    <p class="email-success-description">
                        <strong>ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ì§ì ‘ ë‹µë³€</strong>ë“œë¦¬ê² ìŠµë‹ˆë‹¤.<br>
                        ë³´í†µ <strong>24ì‹œê°„ ì´ë‚´</strong>ì— íšŒì‹ í•´ë“œë¦½ë‹ˆë‹¤.<br>
                        ë§Œì•½ 24ì‹œê°„ ì´ë‚´ì— ë‹µë³€ì´ ì—†ìœ¼ë©´, <strong>ìŠ¤íŒ¸ í´ë”</strong>ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.<br>
                        <br>
                        ì†Œì¤‘í•œ ì—°ë½ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ™
                    </p>
                </div>
            </div>
            
            <div id="emailErrorContainer" class="email-container-hidden">
                <div class="email-error-message">
                    <div class="email-error-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <h4 class="email-error-title">ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h4>
                    <p class="email-error-description" id="emailErrorText">
                        ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>
                        ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.
                    </p>
                    <div class="email-error-actions">
                        <button class="email-retry-button" onclick="retryEmail()">
                            <i class="fas fa-redo"></i> ë‹¤ì‹œ ì‹œë„
                        </button>
                        <button class="email-close-button" onclick="closeEmailModal()">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let lastFormData = null;
        let retryCount = 0;
        const MAX_RETRY = 3;
        let isFormDirty = false; // í¼ì´ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” í”Œë˜ê·¸

        // ì´ë©”ì¼ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function openEmailModal() {
            document.getElementById('emailOverlay').classList.add('active');
            document.body.style.overflow = 'hidden';
            resetEmailForm();
        }

        function closeEmailModal() {
            // í¼ì´ ìˆ˜ì •ëœ ìƒíƒœì—ì„œ ë‹«ìœ¼ë ¤ê³  í•˜ë©´ í™•ì¸ ìš”ì²­
            if (isFormDirty && !confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ì •ë§ ë‹«ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            document.getElementById('emailOverlay').classList.remove('active');
            document.body.style.overflow = '';
            resetEmailForm();
        }

        function resetEmailForm() {
            // í¼ ì´ˆê¸°í™”
            const form = document.querySelector('.email-form');
            if (form) form.reset();
            
            // ì»¨í…Œì´ë„ˆ í‘œì‹œ ìƒíƒœ ì´ˆê¸°í™”
            document.getElementById('emailFormContainer').style.display = 'block';
            document.getElementById('emailSuccessContainer').style.display = 'none';
            document.getElementById('emailErrorContainer').style.display = 'none';
            
            // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
            const submitBtn = document.getElementById('emailSubmitButton');
            submitBtn.disabled = false;
            submitBtn.classList.remove('loading');
            
            // ì˜¤ë¥˜ ìƒíƒœ ì´ˆê¸°í™”
            clearFormErrors();
            hideNetworkError();
            
            // ì¬ì‹œë„ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            retryCount = 0;
            lastFormData = null;
            isFormDirty = false; // ë”í‹° í”Œë˜ê·¸ ì´ˆê¸°í™”
        }

        // í¼ ë”í‹° ìƒíƒœ ì²´í¬ í•¨ìˆ˜
        function markFormDirty() {
            isFormDirty = true;
        }

        // í¼ ìœ íš¨ì„± ê²€ì‚¬
        function validateForm(data) {
            let isValid = true;
            clearFormErrors();

            // ì´ë¦„ ê²€ì‚¬
            if (!data.sender_name || !data.sender_name.trim()) {
                showFieldError('senderName', 'nameError', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            // ì´ë©”ì¼ ê²€ì‚¬
            if (!data.sender_email || !data.sender_email.trim()) {
                showFieldError('senderEmail', 'emailError', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (!validateEmail(data.sender_email.trim())) {
                showFieldError('senderEmail', 'emailError', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            // ì œëª© ê²€ì‚¬
            if (!data.subject || !data.subject.trim()) {
                showFieldError('subject', 'subjectError', 'ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            // ë©”ì‹œì§€ ê²€ì‚¬
            if (!data.message || !data.message.trim()) {
                showFieldError('message', 'messageError', 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            } else if (data.message.trim().length < 10) {
                showFieldError('message', 'messageError', 'ë©”ì‹œì§€ëŠ” 10ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                isValid = false;
            }

            return isValid;
        }

        // ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // í•„ë“œ ì˜¤ë¥˜ í‘œì‹œ
        function showFieldError(fieldId, errorId, message) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(errorId);
            
            field.classList.add('error');
            error.textContent = message;
            error.classList.add('visible');
        }

        // ëª¨ë“  í•„ë“œ ì˜¤ë¥˜ ì œê±°
        function clearFormErrors() {
            const fields = ['senderName', 'senderEmail', 'subject', 'message'];
            const errors = ['nameError', 'emailError', 'subjectError', 'messageError'];
            
            fields.forEach(fieldId => {
                document.getElementById(fieldId).classList.remove('error');
            });
            
            errors.forEach(errorId => {
                const error = document.getElementById(errorId);
                error.classList.remove('visible');
            });
        }

        // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ í‘œì‹œ/ìˆ¨ê¹€
        function showNetworkError() {
            document.getElementById('emailNetworkError').classList.add('visible');
        }

        function hideNetworkError() {
            document.getElementById('emailNetworkError').classList.remove('visible');
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
        function updateErrorMessage(message) {
            document.getElementById('emailErrorText').innerHTML = message;
        }

        // ì´ë©”ì¼ ì „ì†¡ í•¨ìˆ˜ (JSONìœ¼ë¡œ ìˆ˜ì •)
        async function sendEmail(event) {
            event.preventDefault();
            
            const submitBtn = document.getElementById('emailSubmitButton');
            const form = event.target;
            
            // FormData ëŒ€ì‹  JSON ê°ì²´ë¡œ ìƒì„±
            const formData = {
                sender_name: form.sender_name.value,
                sender_email: form.sender_email.value,
                subject: form.subject.value,
                message: form.message.value
            };
            
            // í¼ ìœ íš¨ì„± ê²€ì‚¬
            if (!validateForm(formData)) {
                return;
            }

            // ë§ˆì§€ë§‰ í¼ ë°ì´í„° ì €ì¥ (ì¬ì‹œë„ìš©)
            lastFormData = formData;
            
            // ë¡œë”© ìƒíƒœ
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            hideNetworkError();
            
            try {
                const response = await fetch('/smtp/email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ì„±ê³µ ì‹œ
                    showSuccessMessage();
                    retryCount = 0;
                    isFormDirty = false; // ì „ì†¡ ì„±ê³µ ì‹œ ë”í‹° ìƒíƒœ í•´ì œ
                } else {
                    // ì„œë²„ ì˜¤ë¥˜ ì‹œ
                    const errorMessage = result.message || 'ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    showErrorMessage(errorMessage);
                }
            } catch (error) {
                console.error('Email send error:', error);
                
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ
                if (error.name === 'TypeError' || error.message.includes('fetch')) {
                    showNetworkError();
                    showErrorMessage('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                } else {
                    showErrorMessage('ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                }
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        }

        // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
        function showSuccessMessage() {
            document.getElementById('emailFormContainer').style.display = 'none';
            document.getElementById('emailErrorContainer').style.display = 'none';
            document.getElementById('emailSuccessContainer').style.display = 'block';
            
            // 5ì´ˆ í›„ ìë™ìœ¼ë¡œ ë‹«ê¸° (ì„±ê³µ ë©”ì‹œì§€ë¥¼ ì¶©ë¶„íˆ ì½ì„ ìˆ˜ ìˆë„ë¡)
            setTimeout(() => {
                isFormDirty = false; // ì„±ê³µ í›„ì—ëŠ” ë”í‹° ìƒíƒœ í•´ì œ
                closeEmailModal();
            }, 5000);
        }

        // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
        function showErrorMessage(message) {
            updateErrorMessage(message);
            document.getElementById('emailFormContainer').style.display = 'none';
            document.getElementById('emailSuccessContainer').style.display = 'none';
            document.getElementById('emailErrorContainer').style.display = 'block';
            
            retryCount++;
        }

        // ì¬ì‹œë„ í•¨ìˆ˜ (JSON ë°ì´í„°ë¡œ ìˆ˜ì •)
        async function retryEmail() {
            if (!lastFormData) {
                closeEmailModal();
                return;
            }

            if (retryCount >= MAX_RETRY) {
                updateErrorMessage(
                    'ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.<br>' +
                    'ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•˜ì‹œê±°ë‚˜ ì§ì ‘ ì—°ë½í•´ì£¼ì„¸ìš”.<br>' +
                    '<strong>ì§ì ‘ ì—°ë½: sjmbee04@gmail.com</strong>'
                );
                return;
            }

            // í¼ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            document.getElementById('emailFormContainer').style.display = 'block';
            document.getElementById('emailErrorContainer').style.display = 'none';
            hideNetworkError();
            
            // ë¡œë”© ìƒíƒœ
            const retryBtn = document.querySelector('.email-retry-button');
            retryBtn.disabled = true;
            retryBtn.classList.add('loading');
            
            try {
                const response = await fetch('/smtp/email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(lastFormData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccessMessage();
                    retryCount = 0;
                    isFormDirty = false; // ì¬ì‹œë„ ì„±ê³µ ì‹œ ë”í‹° ìƒíƒœ í•´ì œ
                } else {
                    const errorMessage = result.message || 'ì„œë²„ì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    showErrorMessage(errorMessage);
                }
            } catch (error) {
                console.error('Retry email error:', error);
                showErrorMessage('ì¬ì‹œë„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.<br>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                retryBtn.disabled = false;
                retryBtn.classList.remove('loading');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.addEventListener('DOMContentLoaded', function() {
            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸° (ë”í‹° ìƒíƒœ í™•ì¸)
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('emailOverlay').classList.contains('active')) {
                    closeEmailModal();
                }
            });
            
            // ì˜¤ë²„ë ˆì´ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸° ë°©ì§€ (ë”ì´ìƒ ë‹«íˆì§€ ì•ŠìŒ)
            document.getElementById('emailOverlay').addEventListener('click', function(e) {
                // ë°°ê²½ í´ë¦­ìœ¼ë¡œëŠ” ë‹«íˆì§€ ì•Šë„ë¡ ì£¼ì„ ì²˜ë¦¬
                // if (e.target === this) closeEmailModal();
            });

            // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì˜¤ë¥˜ ìƒíƒœ ì œê±° ë° ë”í‹° í”Œë˜ê·¸ ì„¤ì •
            const fields = ['senderName', 'senderEmail', 'subject', 'message'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                
                // í¬ì»¤ìŠ¤ ì‹œ ì˜¤ë¥˜ ìƒíƒœ ì œê±°
                field.addEventListener('focus', function() {
                    this.classList.remove('error');
                    const errorId = fieldId === 'senderName' ? 'nameError' :
                                    fieldId === 'senderEmail' ? 'emailError' :
                                    fieldId === 'subject' ? 'subjectError' : 'messageError';
                    document.getElementById(errorId).classList.remove('visible');
                });
                
                // ì…ë ¥ ì‹œ ë”í‹° í”Œë˜ê·¸ ì„¤ì •
                field.addEventListener('input', markFormDirty);
                field.addEventListener('change', markFormDirty);
            });
        });
    </script>
</body>
</html>