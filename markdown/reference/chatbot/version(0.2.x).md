# ChatBot - ë²„ì „ ëª…ì„¸ì„œ v0.2.x

## ê°œìš”
ì´ ë¬¸ì„œëŠ” ChatBot ì‹œìŠ¤í…œì˜ v0.2.x ê³„ì—´ ë²„ì „ì— ëŒ€í•œ ê³µì‹ ëª…ì„¸ì„œì…ë‹ˆë‹¤. v0.1.xì˜ ê¸°ë³¸ì ì¸ ì±„íŒ… ë¡œê·¸ ê´€ë¦¬ ì‹œìŠ¤í…œì—ì„œ **Spring Boot ë°±ì—”ë“œ ì™„ì „ í†µí•©**ê³¼ **ìºë¦­í„° ê´€ë¦¬ ì‹œìŠ¤í…œ**, **AI API ì—°ë™**ì„ ë„ì…í•œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì±„íŒ… í”Œë«í¼ì…ë‹ˆë‹¤.

## ë²„ì „ ì •ë³´

| ë²„ì „ | ë¦´ë¦¬ì¦ˆ ë‚ ì§œ | ì»¤ë°‹ í•´ì‹œ | ìƒíƒœ |
|------|-------------|-----------|------|
| **v0.2.0** | 2024-09-10 | `9fdcb3cf` | Stable |
| **v0.2.1** | 2024-09-29 | `c309af86` | Stable |
| **v0.2.2** | 2024-10-23 | `6e402a4c` | Stable |
| **v0.2.3** | 2024-10-26 | `93e63260` | Latest |

## v0.1.xì—ì„œ v0.2.xë¡œì˜ ì£¼ìš” ë³€ê²½ì‚¬í•­

### ë°±ì—”ë“œ ì•„í‚¤í…ì²˜ ì™„ì „ ì „í™˜
- **FastAPI ë‹¨ë…** â†’ **FastAPI + Spring Boot í†µí•©** ì•„í‚¤í…ì²˜
- **Spring Boot** ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì™„ì „ ì•ˆì •í™”
- **Kotlin ê¸°ë°˜** ë°±ì—”ë“œ ì„œë¹„ìŠ¤ í™•ì¥

### ë°ì´í„° ëª¨ë¸ í˜ì‹ 
- **ë‹¨ìˆœ ì±„íŒ… ë¡œê·¸** â†’ **ì‚¬ìš©ì/ìºë¦­í„°/ì±„íŒ…ë°©** í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ
- **MySQL ìŠ¤í‚¤ë§ˆ** í™•ì¥ (users, characters, chatrooms, officerooms)
- **JWT í† í° ì¸ì¦** ë¯¸ë“¤ì›¨ì–´ ë„ì…

### ì‹ ê·œ ê¸°ëŠ¥
- **ìºë¦­í„° ê´€ë¦¬ ì‹œìŠ¤í…œ** (ì´ë¯¸ì§€ ì—…ë¡œë“œ, CRUD)
- **Office ì±„íŒ…ë£¸** ê¸°ëŠ¥ ì¶”ê°€
- **í† í° ì¸ì¦ ë¯¸ë“¤ì›¨ì–´** ë³´ì•ˆ ê°•í™”
- **AI API ì—°ë™** (ì™¸ë¶€ AI ì„œë¹„ìŠ¤ í†µí•©)
- **ê²€ìƒ‰ ê¸°ëŠ¥** (ìºë¦­í„° ë° ë°ì´í„° ê²€ìƒ‰)

### ê°œë°œ í™˜ê²½ ê°œì„ 
- **GitHub Actions** ìë™í™” ê°•í™”
- **ë¹Œë“œ ì‹œìŠ¤í…œ** ìµœì í™” (Gradle ìºì‹œ í™œìš©)
- **ì½”ë“œ í’ˆì§ˆ** ê´€ë¦¬ (Kotlin ì»¨ë²¤ì…˜)

### ì œê±°ëœ ê¸°ëŠ¥
- âŒ **VS Code ì„¤ì • íŒŒì¼** ì •ë¦¬
- âŒ **Spring Boot êµ¬ config** íŒŒì¼ ë§ˆì´ê·¸ë ˆì´ì…˜

## ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

### í•˜ë“œì›¨ì–´ ìš”êµ¬ì‚¬í•­
- **CPU**: ë©€í‹°ì½”ì–´ í”„ë¡œì„¸ì„œ ê¶Œì¥
- **ë©”ëª¨ë¦¬**: ìµœì†Œ 16GB RAM
- **ì €ì¥ê³µê°„**: ìµœì†Œ 30GB ì—¬ìœ  ê³µê°„
- **ë„¤íŠ¸ì›Œí¬**: ê³ ì† ì¸í„°ë„· (AI API ì—°ë™)

### ì†Œí”„íŠ¸ì›¨ì–´ ìš”êµ¬ì‚¬í•­
- **ìš´ì˜ì²´ì œ**: Linux/Windows (Docker ì§€ì›)
- **Java**: 17 ì´ìƒ (Spring Boot)
- **Python**: 3.8 ì´ìƒ (FastAPI)
- **Docker**: 20.10 ì´ìƒ
- **MySQL**: 8.0 ì´ìƒ
- **MongoDB**: 4.4 ì´ìƒ

## ì•„í‚¤í…ì²˜

### í”„ë¡œì íŠ¸ êµ¬ì¡°
```
ğŸ“¦ ChatBot v0.2.x
â”œâ”€â”€ ğŸ“ .github/                  # GitHub Actions
â”‚   â””â”€â”€ ğŸ“ workflows/
â”‚       â””â”€â”€ build-and-push.yml [UPDATED]
â”œâ”€â”€ ğŸ“ fastapi/                  # FastAPI ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ ğŸ“ batchfile/
â”‚   â”‚   â””â”€â”€ venv_setup.bat [UPDATED]
â”‚   â”œâ”€â”€ ğŸ“ sources/
â”‚   â”‚   â”œâ”€â”€ server.py [REORGANIZED]
â”‚   â”‚   â””â”€â”€ ğŸ“ utils/
â”‚   â”‚       â”œâ”€â”€ DB_mongo.py [ENHANCED]
â”‚   â”‚       â””â”€â”€ Models.py [EXPANDED]
â”‚   â””â”€â”€ requirements.txt [UPDATED]
â”œâ”€â”€ ğŸ“ nginx/                    # ì›¹ ì„œë²„ ì„¤ì •
â”‚   â””â”€â”€ nginx.conf [UPDATED]
â”œâ”€â”€ ğŸ“ springboot/               # Spring Boot ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ ğŸ“ src/main/java/com/TreeNut/ChatBot_Backend/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ controller/       # REST API ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterController.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomController.kt [NEW]
â”‚   â”‚   â”‚   â””â”€â”€ UserController.kt [UPDATED]
â”‚   â”‚   â”œâ”€â”€ ğŸ“ model/            # ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â”‚   â”œâ”€â”€ Character.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ Chatroom.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ Officeroom.kt [NEW]
â”‚   â”‚   â”‚   â””â”€â”€ User.kt [UPDATED]
â”‚   â”‚   â”œâ”€â”€ ğŸ“ repository/       # JPA ë¦¬í¬ì§€í† ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterRepository.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatroomRepository.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ OfficeroomRepository.kt [NEW]
â”‚   â”‚   â”‚   â””â”€â”€ UserRepository.kt [UPDATED]
â”‚   â”‚   â”œâ”€â”€ ğŸ“ service/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”‚   â”œâ”€â”€ CharacterService.kt [NEW]
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomService.kt [NEW]
â”‚   â”‚   â”‚   â””â”€â”€ UserService.kt [UPDATED]
â”‚   â”‚   â”œâ”€â”€ ğŸ“ middleware/       # ë¯¸ë“¤ì›¨ì–´
â”‚   â”‚   â”‚   â””â”€â”€ TokenAuth.kt [NEW]
â”‚   â”‚   â”œâ”€â”€ ğŸ“ exceptions/       # ì˜ˆì™¸ ì²˜ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ TokenAuthException.kt [NEW]
â”‚   â”‚   â””â”€â”€ ğŸ“ config/           # ì„¤ì •
â”‚   â”‚       â”œâ”€â”€ SecurityConfig.kt [MOVED]
â”‚   â”‚       â””â”€â”€ WebClientConfig.kt [NEW]
â”‚   â”œâ”€â”€ build.gradle.kts [OPTIMIZED]
â”‚   â”œâ”€â”€ gradle.properties [NEW]
â”‚   â””â”€â”€ wait-for-it.sh [NEW]
â”œâ”€â”€ ğŸ“ mysql/                    # MySQL ë°ì´í„°ë² ì´ìŠ¤
â”‚   â””â”€â”€ init.sql [EXPANDED]
â”œâ”€â”€ docker-compose.yml [UPDATED]
â”œâ”€â”€ rebuild.bat [OPTIMIZED]
â””â”€â”€ react_build.bat [NEW]
```

## API ëª…ì„¸

### Spring Boot API

#### ì‚¬ìš©ì ê´€ë¦¬ API (`/api/users`)

##### POST /api/users/register
ì‚¬ìš©ì íšŒì›ê°€ì… API

**ìš”ì²­ í˜•ì‹:**
```json
{
  "username": "string",
  "email": "string",
  "password": "string"
}
```

##### DELETE /api/users/{id}
ì‚¬ìš©ì ì‚­ì œ API

**ê²½ë¡œ ë§¤ê°œë³€ìˆ˜:**
- `id`: ì‚¬ìš©ì ID

#### ìºë¦­í„° ê´€ë¦¬ API (`/api/characters`)

##### POST /api/characters
ìºë¦­í„° ìƒì„± API (í† í° ì¸ì¦ í•„ìš”)

**ìš”ì²­ í˜•ì‹:**
```json
{
  "name": "string",
  "greeting": "string",
  "context": "string",
  "imageUrl": "string (optional)"
}
```

##### GET /api/characters
ìºë¦­í„° ëª©ë¡ ì¡°íšŒ API

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°:**
- `search`: ê²€ìƒ‰ì–´ (optional)
- `userId`: ì‚¬ìš©ì ID (ë³¸ì¸ ìºë¦­í„°ë§Œ ì¡°íšŒ)

##### PUT /api/characters/{id}
ìºë¦­í„° ìˆ˜ì • API

##### DELETE /api/characters/{id}
ìºë¦­í„° ì‚­ì œ API

#### ì±„íŒ…ë°© ê´€ë¦¬ API (`/api/rooms`)

##### POST /api/chatrooms
ì¼ë°˜ ì±„íŒ…ë°© ìƒì„± API

##### POST /api/officerooms
Office ì±„íŒ…ë°© ìƒì„± API

##### GET /api/chatrooms/{id}/logs
ì±„íŒ… ë¡œê·¸ ì¡°íšŒ API

##### PUT /api/chatrooms/{id}/logs
ì±„íŒ… ë¡œê·¸ ì—…ë°ì´íŠ¸ API

##### DELETE /api/chatrooms/{id}/logs
ì±„íŒ… ë¡œê·¸ ì‚­ì œ API

##### DELETE /api/officerooms/{id}
Office ì±„íŒ…ë°© ì‚­ì œ API

### FastAPI API

#### MongoDB ë¼ìš°í„° (`/mongo`)

##### POST /mongo/office/create
Office ì±„íŒ…ë°© ë¬¸ì„œ ìƒì„±

##### PUT /mongo/office/save_log
Office ì±„íŒ… ë¡œê·¸ ì €ì¥

##### PUT /mongo/office/update_log
Office ì±„íŒ… ë¡œê·¸ ì—…ë°ì´íŠ¸

##### POST /mongo/office/load_log
Office ì±„íŒ… ë¡œê·¸ ì¡°íšŒ

##### DELETE /mongo/office/delete_log
Office ì±„íŒ… ë¡œê·¸ ì¼ë¶€ ì‚­ì œ

##### DELETE /mongo/office/delete_room
Office ì±„íŒ…ë°© ì‚­ì œ

#### Chatbot ë¼ìš°í„° (`/mongo/chatbot`)

##### POST /mongo/chatbot/create
Chatbot ì±„íŒ…ë°© ë¬¸ì„œ ìƒì„±

##### PUT /mongo/chatbot/save_log
Chatbot ì±„íŒ… ë¡œê·¸ ì €ì¥

##### PUT /mongo/chatbot/update_log
Chatbot ì±„íŒ… ë¡œê·¸ ì—…ë°ì´íŠ¸

##### POST /mongo/chatbot/load_log
Chatbot ì±„íŒ… ë¡œê·¸ ì¡°íšŒ

##### DELETE /mongo/chatbot/delete_log
Chatbot ì±„íŒ… ë¡œê·¸ ì¼ë¶€ ì‚­ì œ

##### DELETE /mongo/chatbot/delete_room
Chatbot ì±„íŒ…ë°© ì‚­ì œ

**HTTP ìƒíƒœ ì½”ë“œ:**
- `200`: ì„±ê³µ
- `400`: ì˜ëª»ëœ ìš”ì²­
- `401`: ì¸ì¦ ì‹¤íŒ¨
- `403`: ê¶Œí•œ ì—†ìŒ
- `422`: ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨
- `500`: ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜

## ì£¼ìš” ì»´í¬ë„ŒíŠ¸

### 1. Spring Boot ì»¨íŠ¸ë¡¤ëŸ¬ - v0.2.x ì‹ ê·œ

#### CharacterController.kt (ì‹ ê·œ ì¶”ê°€) - ì„œì •í›ˆ
ìºë¦­í„° ê´€ë¦¬ë¥¼ ìœ„í•œ REST API ì»¨íŠ¸ë¡¤ëŸ¬ì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- ìºë¦­í„° CRUD operations
- ì´ë¯¸ì§€ ì—…ë¡œë“œ ì§€ì›
- ê²€ìƒ‰ ê¸°ëŠ¥
- í† í° ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ì ìš©

```kotlin
@RestController
@RequestMapping("/api/characters")
class CharacterController(
    private val characterService: CharacterService,
    private val tokenAuth: TokenAuth
) {
    
    @PostMapping
    fun createCharacter(
        @RequestBody character: Character,
        @RequestHeader("Authorization") token: String
    ): ResponseEntity<Character> {
        // í† í° ê²€ì¦
        tokenAuth.validateToken(token)
        
        return ResponseEntity.ok(characterService.createCharacter(character))
    }
    
    @GetMapping
    fun getAllCharacters(
        @RequestParam(required = false) search: String?,
        @RequestParam(required = false) userId: Long?
    ): ResponseEntity<List<Character>> {
        return ResponseEntity.ok(characterService.findCharacters(search, userId))
    }
    
    @PutMapping("/{id}")
    fun updateCharacter(
        @PathVariable id: Long,
        @RequestBody character: Character
    ): ResponseEntity<Character> {
        return ResponseEntity.ok(characterService.updateCharacter(id, character))
    }
    
    @DeleteMapping("/{id}")
    fun deleteCharacter(@PathVariable id: Long): ResponseEntity<Void> {
        characterService.deleteCharacter(id)
        return ResponseEntity.noContent().build()
    }
}
```

#### RoomController.kt (ì‹ ê·œ ì¶”ê°€) - ì„œì •í›ˆ
ì±„íŒ…ë°© ê´€ë¦¬ë¥¼ ìœ„í•œ REST API ì»¨íŠ¸ë¡¤ëŸ¬ì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- ì±„íŒ…ë°© ìƒì„± ë° ì‚­ì œ
- ì±„íŒ… ë¡œê·¸ ê´€ë¦¬ (CRUD)
- Office ë£¸ ì „ìš© ê¸°ëŠ¥
- AI API ì—°ë™ ì¤€ë¹„

```kotlin
@RestController
@RequestMapping("/api/rooms")
class RoomController(
    private val roomService: RoomService
) {
    
    @PostMapping("/chatrooms")
    fun createChatroom(@RequestBody chatroom: Chatroom): ResponseEntity<Chatroom> {
        return ResponseEntity.ok(roomService.createChatroom(chatroom))
    }
    
    @PostMapping("/officerooms")
    fun createOfficeroom(@RequestBody officeroom: Officeroom): ResponseEntity<Officeroom> {
        return ResponseEntity.ok(roomService.createOfficeroom(officeroom))
    }
    
    @GetMapping("/chatrooms/{id}/logs")
    fun getChatroomLogs(@PathVariable id: String): ResponseEntity<List<Any>> {
        return ResponseEntity.ok(roomService.getChatroomLogs(id))
    }
    
    @PutMapping("/chatrooms/{id}/logs")
    fun updateChatroomLog(
        @PathVariable id: String,
        @RequestBody logData: Map<String, Any>
    ): ResponseEntity<String> {
        return ResponseEntity.ok(roomService.updateChatroomLog(id, logData))
    }
    
    @DeleteMapping("/chatrooms/{id}/logs")
    fun deleteChatroomLog(
        @PathVariable id: String,
        @RequestParam index: Int
    ): ResponseEntity<String> {
        return ResponseEntity.ok(roomService.deleteChatroomLog(id, index))
    }
    
    @DeleteMapping("/officerooms/{id}")
    fun deleteOfficeroom(@PathVariable id: String): ResponseEntity<Void> {
        roomService.deleteOfficeroom(id)
        return ResponseEntity.noContent().build()
    }
}
```

### 2. ë°ì´í„° ëª¨ë¸ - v0.2.x í™•ì¥

#### Character.kt (ì‹ ê·œ) - ì„œì •í›ˆ
ìºë¦­í„° ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```kotlin
@Entity
@Table(name = "characters")
data class Character(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long = 0,
    
    @Column(nullable = false, length = 100)
    val name: String,
    
    @Column(columnDefinition = "TEXT")
    val greeting: String,
    
    @Column(columnDefinition = "TEXT")
    val context: String,
    
    @Column(name = "image_url", length = 500)
    val imageUrl: String? = null,
    
    @Column(name = "access_level", nullable = false)
    val accessLevel: Boolean = true,
    
    @Column(name = "user_id")
    val userId: Long? = null,
    
    @Column(name = "created_at", updatable = false)
    val createdAt: LocalDateTime = LocalDateTime.now(),
    
    @Column(name = "updated_at")
    val updatedAt: LocalDateTime = LocalDateTime.now()
)
```

#### Chatroom.kt (ì‹ ê·œ) - ì„œì •í›ˆ
ì¼ë°˜ ì±„íŒ…ë°© ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```kotlin
@Entity
@Table(name = "chatrooms")
data class Chatroom(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long = 0,
    
    @Column(name = "room_id", nullable = false, unique = true, length = 36)
    val roomId: String,
    
    @Column(name = "user_id", nullable = false)
    val userId: Long,
    
    @Column(name = "character_id")
    val characterId: Long? = null,
    
    @Column(name = "room_name", length = 200)
    val roomName: String? = null,
    
    @Column(name = "created_at", updatable = false)
    val createdAt: LocalDateTime = LocalDateTime.now(),
    
    @Column(name = "updated_at")
    val updatedAt: LocalDateTime = LocalDateTime.now()
)
```

#### Officeroom.kt (ì‹ ê·œ) - ì„œì •í›ˆ
Office ì±„íŒ…ë°© ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹° í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

```kotlin
@Entity
@Table(name = "officerooms")
data class Officeroom(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long = 0,
    
    @Column(name = "room_id", nullable = false, unique = true, length = 36)
    val roomId: String,
    
    @Column(name = "user_id", nullable = false)
    val userId: Long,
    
    @Column(name = "room_name", length = 200)
    val roomName: String? = null,
    
    @Column(name = "room_type", length = 50)
    val roomType: String = "office",
    
    @Column(name = "created_at", updatable = false)
    val createdAt: LocalDateTime = LocalDateTime.now(),
    
    @Column(name = "updated_at")
    val updatedAt: LocalDateTime = LocalDateTime.now()
)
```

### 3. ë¯¸ë“¤ì›¨ì–´ ì‹œìŠ¤í…œ - v0.2.x ì‹ ê·œ

#### TokenAuth.kt (ì‹ ê·œ) - ì„œì •í›ˆ
JWT í† í° ê¸°ë°˜ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ì…ë‹ˆë‹¤.

**ì£¼ìš” ê¸°ëŠ¥:**
- JWT í† í° ê²€ì¦
- ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸
- ê¶Œí•œ ê¸°ë°˜ ì ‘ê·¼ ì œì–´
- í† í° ë§Œë£Œ ì²˜ë¦¬

```kotlin
@Component
class TokenAuth {
    
    @Value("\${jwt.secret}")
    private lateinit var jwtSecret: String
    
    @Value("\${jwt.expiration}")
    private var jwtExpiration: Long = 86400000 // 24ì‹œê°„
    
    fun validateToken(token: String): Boolean {
        return try {
            val cleanToken = token.removePrefix("Bearer ")
            val claims = Jwts.parser()
                .setSigningKey(jwtSecret)
                .parseClaimsJws(cleanToken)
                .body
            
            !claims.expiration.before(Date())
        } catch (e: Exception) {
            throw TokenAuthException("Invalid or expired token")
        }
    }
    
    fun getUserIdFromToken(token: String): Long {
        val cleanToken = token.removePrefix("Bearer ")
        val claims = Jwts.parser()
            .setSigningKey(jwtSecret)
            .parseClaimsJws(cleanToken)
            .body
        
        return claims.subject.toLong()
    }
    
    fun generateToken(userId: Long): String {
        val now = Date()
        val expiration = Date(now.time + jwtExpiration)
        
        return Jwts.builder()
            .setSubject(userId.toString())
            .setIssuedAt(now)
            .setExpiration(expiration)
            .signWith(SignatureAlgorithm.HS512, jwtSecret)
            .compact()
    }
}
```

### 4. FastAPI ë¼ìš°í„° ì¬êµ¬ì„± - v0.2.x

#### ì„œë²„ êµ¬ì¡° ê°œì„  (server.py) - ì„œì •í›ˆ
FastAPI ì„œë²„ê°€ Officeì™€ Chatbot ë¼ìš°í„°ë¡œ ë¶„ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.

```python
# FastAPI ë¼ìš°í„° ì‹œìŠ¤í…œ ê°œì„ 
office_router = APIRouter()  # Office ê´€ë ¨ ë¼ìš°í„° ì •ì˜
chatbot_router = APIRouter() # Chatbot ê´€ë ¨ ë¼ìš°í„° ì •ì˜

@office_router.post("/create", summary="ìœ ì € ì±„íŒ…ë°© ID ìƒì„±")
async def create_chat(request: ChatModel.Id_Request):
    try:
        document_id = await mongo_handler.create_collection(
            user_id=request.user_id,
            router="office"
        )
        return {"Document ID": document_id}
    except Exception as e:
        raise ChatError.InternalServerErrorException(detail=str(e))

@office_router.put("/save_log", summary="ìœ ì € ì±„íŒ… ì €ì¥")
async def save_chat_log(request: ChatModel.Office_Create_Request):
    try:
        request_data = request.model_dump()
        filtered_data = {key: value for key, value in request_data.items() if key != 'id'}
        
        response_message = await mongo_handler.add_office_log(
            user_id=request.user_id,
            document_id=request.id,
            new_data=filtered_data
        )
        return {"Result": response_message}
    except ValidationError as e:
        raise ChatError.BadRequestException(detail=str(e))
    except Exception as e:
        raise ChatError.InternalServerErrorException(detail=str(e))

# mongo_routerì— ì„¸ë¶„í™”ëœ ë¼ìš°í„° ì¶”ê°€
mongo_router.include_router(office_router, prefix="/office", tags=["MongoDB Router / Office Router"])
mongo_router.include_router(chatbot_router, prefix="/chatbot", tags=["MongoDB Router / Chatbot Router"])
```

#### MongoDB í•¸ë“¤ëŸ¬ í™•ì¥ (DB_mongo.py) - ì„œì •í›ˆ
ë¼ìš°í„°ë³„ ë°ì´í„° ê´€ë¦¬ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

```python
async def create_collection(self, user_id: str, router: str) -> str:
    """
    ì‚¬ìš©ì IDì™€ ë¼ìš°í„° íƒ€ì…ì— ê¸°ë°˜í•œ ì±„íŒ… ë¡œê·¸ ì»¬ë ‰ì…˜ì„ ìƒì„±í•©ë‹ˆë‹¤.
    
    Args:
        user_id (str): ì‚¬ìš©ì ID
        router (str): ë¼ìš°í„° íƒ€ì… ("office" ë˜ëŠ” "chatbot")
    
    Returns:
        str: ìƒì„±ëœ ë¬¸ì„œ ID
    """
    try:
        collection_name = f'{router}_log_{user_id}'
        collection = self.db[collection_name]
        document = {
            "id": str(uuid.uuid4()),
            "created_at": datetime.utcnow(),
            "value": []
        }
        await collection.insert_one(document)
        return document["id"]
    except Exception as e:
        raise InternalServerErrorException(detail=f"Error creating {router} collection: {str(e)}")

async def get_log(self, user_id: str, document_id: str, router: str) -> List[Dict]:
    """
    íŠ¹ì • ë¼ìš°í„°ì˜ ì±„íŒ… ë¡œê·¸ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.
    
    Args:
        user_id (str): ì‚¬ìš©ì ID
        document_id (str): ë¬¸ì„œ ID
        router (str): ë¼ìš°í„° íƒ€ì…
    
    Returns:
        List[Dict]: ì •ë ¬ëœ ì±„íŒ… ë¡œê·¸ ë¦¬ìŠ¤íŠ¸
    """
    try:
        collection = self.db[f'{router}_log_{user_id}']
        document = await collection.find_one({"id": document_id})
        
        if document is None:
            raise NotFoundException(f"No document found with ID: {document_id}")
        
        value_list = document.get("value", [])
        sorted_value_list = sorted(value_list, key=lambda x: x.get("index"))
        
        return sorted_value_list
    except Exception as e:
        raise InternalServerErrorException(detail=f"Error retrieving {router} log: {str(e)}")
```

### 5. ë°ì´í„° ëª¨ë¸ í™•ì¥ (Models.py) - v0.2.x

#### í†µí•© í•„ë“œ ì •ì˜ ì‹œìŠ¤í…œ
ì½”ë“œ ì¬ì‚¬ìš©ì„±ì„ ë†’ì´ê¸° ìœ„í•œ ê³µí†µ í•„ë“œ ì •ì˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

```python
# ê³µí†µ í•„ë“œ ì •ì˜
user_id_set = Field(
    examples=["shaa97102"],
    title="ìœ ì € id",
    min_length=6, max_length=50,
    description="ìœ ì € id ê¸¸ì´ ì œì•½"
)

id_set = Field(
    examples=["123e4567-e89b-12d3-a456-426614174000"],
    title="ì±„íŒ…ë°© id",
    min_length=1, max_length=36,
    description="UUID í˜•ì‹"
)

index_set = Field(
    examples=[1],
    title="ì±„íŒ…ë°© log index",
    description="int í˜•ì‹"
)

# ë¼ìš°í„°ë³„ ì „ìš© ëª¨ë¸
class Office_Create_Request(BaseModel):
    user_id: str = user_id_set
    id: str = id_set
    input_data: str = input_data_set
    output_data: str = output_data_set

class Office_Update_Request(BaseModel):
    user_id: str = user_id_set
    id: str = id_set
    input_data: str = input_data_set
    output_data: str = output_data_set
    index: NATURAL_NUM = index_set

class ChatBot_Create_Request(BaseModel):
    user_id: str = user_id_set
    id: str = id_set
    img_url: str = img_url_set
    input_data: str = input_data_set
    output_data: str = output_data_set

class ChatBot_Update_Request(BaseModel):
    user_id: str = user_id_set
    id: str = id_set
    img_url: str = img_url_set
    input_data: str = input_data_set
    output_data: str = output_data_set
    index: NATURAL_NUM = index_set
```

### 6. ë¹Œë“œ ì‹œìŠ¤í…œ ìµœì í™” - v0.2.x

#### Gradle ìµœì í™” (build.gradle.kts) - ì„œì •í›ˆ
Spring Boot ë¹Œë“œ ì„±ëŠ¥ê³¼ AI API ì—°ë™ì„ ìœ„í•œ ì˜ì¡´ì„±ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.

**ì£¼ìš” ê°œì„ ì‚¬í•­:**
- ë¹Œë“œ ìºì‹œ ìµœì í™”
- í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ ì˜µì…˜
- AI API ì—°ë™ ë¼ì´ë¸ŒëŸ¬ë¦¬
- WebClient ì„¤ì •

```kotlin
dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.boot:spring-boot-starter-data-jpa")
    implementation("org.springframework.boot:spring-boot-starter-security")
    implementation("org.springframework.boot:spring-boot-starter-webflux") // WebClientìš©
    
    // JWT í† í° ì²˜ë¦¬
    implementation("io.jsonwebtoken:jjwt:0.9.1")
    
    // MySQL ë“œë¼ì´ë²„
    implementation("mysql:mysql-connector-java:8.0.33")
    
    // Kotlin ì§€ì›
    implementation("org.jetbrains.kotlin:kotlin-reflect")
    implementation("org.jetbrains.kotlin:kotlin-stdlib-jdk8")
    
    // JSON ì²˜ë¦¬
    implementation("com.fasterxml.jackson.module:jackson-module-kotlin")
    
    testImplementation("org.springframework.boot:spring-boot-starter-test")
}

tasks.withType<Test> {
    useJUnitPlatform()
    enabled = false // ë¹Œë“œ ì‹œ í…ŒìŠ¤íŠ¸ ìŠ¤í‚µ
}
```

## ì„¤ì¹˜ ë° ì„¤ì •

### Docker ê¸°ë°˜ í†µí•© ë°°í¬ ì‹œìŠ¤í…œ

#### í™˜ê²½ êµ¬ì„±
1. **Docker & Docker Compose** ì„¤ì¹˜
2. **MySQL ë° MongoDB** ì»¨í…Œì´ë„ˆ ì„¤ì •
3. **í™˜ê²½ ë³€ìˆ˜** ì„¤ì • (.env íŒŒì¼)
4. **AI API í‚¤** ì„¤ì • (ì™¸ë¶€ AI ì„œë¹„ìŠ¤ìš©)

#### ë¹ ë¥¸ ì‹œì‘
```bash
# 1. ë¦¬í¬ì§€í† ë¦¬ í´ë¡ 
git clone https://github.com/TreeNut-KR/ChatBot_Docker.git
cd ChatBot_Docker

# 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
cp .env.example .env
# .env íŒŒì¼ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ë° API ì„¤ì •

# 3. ì»¨í…Œì´ë„ˆ ë¹Œë“œ ë° ì‹¤í–‰
docker-compose up --build

# 4. ì„œë¹„ìŠ¤ ì ‘ê·¼ í™•ì¸
# FastAPI: http://localhost:8000
# Spring Boot: http://localhost:8080
# MySQL: localhost:3308
# MongoDB: localhost:27017
```

#### ì„œë¹„ìŠ¤ í¬íŠ¸ ì„¤ì •
- **FastAPI**: 8000 (MongoDB API)
- **Spring Boot**: 8080 (MySQL API)
- **MySQL**: 3308 (ì™¸ë¶€ ì ‘ê·¼)
- **MongoDB**: 27017 (FastAPI ì „ìš©)
- **nginx**: 80 (í”„ë¡ì‹œ ì„œë²„)

### ê°œë°œ í™˜ê²½ ì„¤ì •

#### Spring Boot ê°œë°œí™˜ê²½
```bash
# Gradle ë¹Œë“œ
cd springboot
./gradlew build -x test

# ê°œë°œ ì„œë²„ ì‹¤í–‰
./gradlew bootRun
```

#### FastAPI ê°œë°œí™˜ê²½
```bash
# ê°€ìƒí™˜ê²½ ì„¤ì •
cd fastapi
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# ë˜ëŠ”
.venv\Scripts\activate  # Windows

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt

# ê°œë°œ ì„œë²„ ì‹¤í–‰
uvicorn sources.server:app --reload --host 0.0.0.0 --port 8000
```

## ìš´ì˜ ê°€ì´ë“œ

### í™˜ê²½ ì„¤ì •
1. **Docker í™˜ê²½** êµ¬ì„± ë° ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
2. **ë°ì´í„°ë² ì´ìŠ¤** ì´ˆê¸°í™” (MySQL ìŠ¤í‚¤ë§ˆ, MongoDB ì»¬ë ‰ì…˜)
3. **ì¸ì¦ ì‹œìŠ¤í…œ** ì„¤ì • (JWT ì‹œí¬ë¦¿ í‚¤)
4. **AI API** ì—°ë™ ì„¤ì • (ì™¸ë¶€ ì„œë¹„ìŠ¤ í‚¤)

### ëª¨ë‹ˆí„°ë§ í¬ì¸íŠ¸
- **ì»¨í…Œì´ë„ˆ ìƒíƒœ**: `docker-compose ps`
- **ì„œë¹„ìŠ¤ ë¡œê·¸**: `docker-compose logs [service_name]`
- **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°**: MySQL/MongoDB ì—°ê²° ìƒíƒœ
- **API ì—”ë“œí¬ì¸íŠ¸**: Spring Boot/FastAPI í—¬ìŠ¤ì²´í¬
- **ì¸ì¦ ë¯¸ë“¤ì›¨ì–´**: JWT í† í° ê²€ì¦ ì„±ê³µë¥ 

### ë¬¸ì œ í•´ê²°
- **ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘**: `docker-compose restart [service_name]`
- **ë¹Œë“œ ìºì‹œ ì‚­ì œ**: `docker-compose build --no-cache`
- **ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**: ë³¼ë¥¨ ì‚­ì œ í›„ ì¬ìƒì„±
- **í† í° ì¸ì¦ ì˜¤ë¥˜**: JWT ì‹œí¬ë¦¿ í‚¤ ë° ë§Œë£Œ ì‹œê°„ í™•ì¸
- **AI API ì—°ë™ ì‹¤íŒ¨**: API í‚¤ ìœ íš¨ì„± ë° ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ê°•í™”ëœ ë³´ì•ˆ ê¸°ëŠ¥
- **JWT í† í° ì¸ì¦**: ëª¨ë“  ë¯¼ê°í•œ API ì—”ë“œí¬ì¸íŠ¸ ë³´í˜¸
- **ë¯¸ë“¤ì›¨ì–´ ê²€ì¦**: Spring Boot ìš”ì²­ ì „ì²˜ë¦¬
- **ë°ì´í„°ë² ì´ìŠ¤ ë¶„ë¦¬**: MySQL(ë©”íƒ€ë°ì´í„°) + MongoDB(ì±„íŒ…ë¡œê·¸)
- **í™˜ê²½ ë³€ìˆ˜ ë³´í˜¸**: Docker Secrets í™œìš©

### API ë³´ì•ˆ ê°•í™”
- **í† í° ê¸°ë°˜ ì¸ì¦**: ì‚¬ìš©ìë³„ ì„¸ì…˜ ê´€ë¦¬
- **CORS ì„¤ì •**: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ ì ‘ê·¼
- **ì…ë ¥ ê²€ì¦**: Kotlin/Python ë°ì´í„° ëª¨ë¸ ê²€ì¦
- **SQL ì¸ì ì…˜ ë°©ì§€**: JPA ì¿¼ë¦¬ ë©”ì„œë“œ ì‚¬ìš©
- **NoSQL ì¸ì ì…˜ ë°©ì§€**: MongoDB íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

### ë°ì´í„° ë³´í˜¸
- **ì‚¬ìš©ìë³„ ê²©ë¦¬**: ì±„íŒ… ë°ì´í„° ì‚¬ìš©ìë³„ ë¶„ë¦¬
- **ìºë¦­í„° ì†Œìœ ê¶Œ**: ì‚¬ìš©ìë³„ ìºë¦­í„° ì ‘ê·¼ ì œì–´
- **ì±„íŒ…ë°© ê¶Œí•œ**: ë°© ìƒì„±ì ê¸°ë°˜ ê¶Œí•œ ê´€ë¦¬
- **í† í° ë§Œë£Œ**: ìë™ ì„¸ì…˜ ë§Œë£Œ ë°